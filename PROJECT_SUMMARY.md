# สรุปโครงการแปลง GUI เป็น Web Application

## ภาพรวมโครงการ

โครงการนี้เป็นการแปลงระบบนับลูกค้าผ่านกล้องวงจรปิดจากเดิมที่ใช้ GUI บน Desktop (Tkinter) ให้เป็นเว็บแอปพลิเคชันที่สามารถเข้าถึงได้ผ่านเว็บเบราว์เซอร์ โดยใช้ Flask เป็นเว็บเฟรมเวิร์ก

## ประโยชน์ที่ได้รับ

1. **การเข้าถึงได้จากทุกที่** - ผู้ใช้สามารถเข้าถึงระบบผ่านเว็บเบราว์เซอร์จากอุปกรณ์ใดก็ได้ที่เชื่อมต่อกับเครือข่ายเดียวกัน
2. **ไม่ต้องติดตั้งโปรแกรมเพิ่มเติม** - ไม่จำเป็นต้องติดตั้งโปรแกรมเพิ่มเติมบนเครื่องลูกข่าย เพียงแค่มีเว็บเบราว์เซอร์ก็สามารถใช้งานได้
3. **รองรับอุปกรณ์หลากหลาย** - สามารถใช้งานได้บนคอมพิวเตอร์, แท็บเล็ต, หรือสมาร์ทโฟน
4. **การจัดการการอัพเดตที่ง่ายขึ้น** - อัพเดตที่เซิร์ฟเวอร์เพียงครั้งเดียว แทนที่จะต้องอัพเดตทุกเครื่องที่ติดตั้งโปรแกรม
5. **ประสิทธิภาพการใช้ทรัพยากร** - ลดภาระการประมวลผลบนเครื่องลูกข่าย ใช้ทรัพยากรของเซิร์ฟเวอร์หลักในการประมวลผลภาพ

## โครงสร้างไฟล์

```
├── web_app.py                # ไฟล์หลักของเว็บแอปพลิเคชัน
├── requirements_webapp.txt   # รายการไลบรารีที่ต้องติดตั้ง
├── run_webapp.sh             # สคริปต์เริ่มการทำงานของเว็บแอป
├── setup_webapp.sh           # สคริปต์ติดตั้งเว็บแอป
├── test_camera_web.py        # เครื่องมือทดสอบการเชื่อมต่อกับกล้อง
├── README.md                 # เอกสารอธิบายโครงการ
├── config.ini                # ไฟล์การตั้งค่า
├── static/                   # ไฟล์คงที่ (CSS, JavaScript, รูปภาพ)
│   ├── css/
│   │   └── style.css         # ไฟล์ CSS หลัก
│   ├── js/
│   │   └── main.js           # ไฟล์ JavaScript หลัก
│   └── snapshots/            # โฟลเดอร์เก็บภาพถ่าย
├── templates/                # เทมเพลต HTML
│   ├── dashboard.html        # หน้าหลัก
│   ├── cameras.html          # หน้าจัดการกล้อง
│   ├── stats.html            # หน้าสถิติและรายงาน
│   ├── settings.html         # หน้าตั้งค่า
│   └── error.html            # หน้าแสดงข้อความผิดพลาด
└── client/                   # โมดูลดั้งเดิมจาก GUI
    ├── config_manager.py     # จัดการการตั้งค่า
    ├── camera_counter.py     # นับลูกค้าผ่านกล้อง
    ├── data_manager.py       # จัดการข้อมูล
    └── api_client.py         # เชื่อมต่อกับ API
```

## เทคโนโลยีที่ใช้

### Backend
- **Flask**: เว็บเฟรมเวิร์กสำหรับ Python
- **OpenCV**: ประมวลผลภาพและวิดีโอ
- **SQLite**: ฐานข้อมูลสำหรับเก็บข้อมูลลูกค้า

### Frontend
- **HTML/CSS/JavaScript**: สร้างส่วนติดต่อผู้ใช้
- **Bootstrap 5**: เฟรมเวิร์ก CSS สำหรับการออกแบบที่ตอบสนอง
- **Font Awesome**: ไอคอนสำหรับส่วนติดต่อผู้ใช้
- **Chart.js**: สร้างกราฟสำหรับแสดงสถิติ

## การทำงานของระบบ

### การรับ-ส่งภาพวิดีโอ
1. กล้องส่งภาพผ่านโปรโตคอล RTSP มายังเซิร์ฟเวอร์
2. เซิร์ฟเวอร์ประมวลผลภาพด้วย OpenCV เพื่อตรวจจับและนับคน
3. แปลงภาพเป็น Base64 และส่งไปยังเว็บเบราว์เซอร์ผ่าน AJAX
4. เว็บเบราว์เซอร์แสดงภาพในหน้าเว็บ

### การนับลูกค้า
1. ระบบตรวจจับการเคลื่อนไหวในภาพด้วยเทคนิค Background Subtraction
2. ตรวจสอบวัตถุที่เคลื่อนที่ผ่านเส้นตรวจจับ
3. นับเป็นการเข้าหรือออกตามทิศทางการเคลื่อนที่
4. บันทึกข้อมูลลงฐานข้อมูล

### การจัดการกล้อง
1. สามารถเพิ่ม แก้ไข ลบกล้องผ่านเว็บแอปพลิเคชัน
2. รองรับกล้องหลายตัวและหลายประเภท (Dahua, Hikvision, Generic)
3. สามารถทดสอบการเชื่อมต่อกับกล้องได้ก่อนใช้งานจริง

### การซิงค์ข้อมูล
1. ข้อมูลลูกค้าถูกจัดเก็บในฐานข้อมูล SQLite ในเครื่อง
2. ระบบซิงค์ข้อมูลกับเซิร์ฟเวอร์กลางตามรอบเวลาที่กำหนด
3. ทำงานได้แบบออฟไลน์เมื่อไม่มีการเชื่อมต่ออินเทอร์เน็ต

## วิธีการติดตั้ง

### 1. ติดตั้งด้วยสคริปต์อัตโนมัติ

```bash
# ให้สิทธิ์การรันสคริปต์
chmod +x setup_webapp.sh

# รันสคริปต์ติดตั้ง
./setup_webapp.sh
```

### 2. เริ่มการทำงาน

```bash
# ให้สิทธิ์การรันสคริปต์
chmod +x run_webapp.sh

# เริ่มเว็บแอปพลิเคชัน
./run_webapp.sh
```

### 3. เข้าถึงเว็บแอปพลิเคชัน

เปิดเว็บเบราว์เซอร์และเข้าสู่:
```
http://localhost:8080
```

## ความท้าทายและการแก้ไข

### 1. การส่งภาพวิดีโอแบบเรียลไทม์
- **ปัญหา**: การส่งวิดีโอผ่านเว็บใช้แบนด์วิดท์สูง
- **การแก้ไข**: ใช้การบีบอัดภาพและปรับลดอัตราเฟรมให้เหมาะสม

### 2. การจัดการกล้องหลายตัว
- **ปัญหา**: ต้องประมวลผลวิดีโอจากหลายกล้องพร้อมกัน
- **การแก้ไข**: ใช้ multi-threading และปรับขนาดภาพให้เหมาะสม

### 3. การทำงานแบบออฟไลน์
- **ปัญหา**: ต้องจัดการข้อมูลเมื่อไม่มีการเชื่อมต่อกับเซิร์ฟเวอร์
- **การแก้ไข**: ใช้ SQLite เก็บข้อมูลในเครื่องและซิงค์เมื่อมีการเชื่อมต่อ

## การปรับแต่งประสิทธิภาพ

1. **การลดการใช้ CPU**:
   - ลดขนาดภาพและจำนวนเฟรมต่อวินาที
   - ใช้ Gaussian blur ลดสัญญาณรบกวนและเพิ่มประสิทธิภาพการตรวจจับ

2. **การลดการใช้แบนด์วิดท์**:
   - บีบอัดภาพก่อนส่งไปยังเว็บเบราว์เซอร์
   - กำหนดคุณภาพ JPEG ที่เหมาะสม (75-80%)

3. **การเพิ่มความแม่นยำ**:
   - ปรับค่าพารามิเตอร์การตรวจจับให้เหมาะกับสภาพแวดล้อม
   - เพิ่มความยืดหยุ่นในการตั้งค่าเส้นตรวจจับ

## การพัฒนาในอนาคต

1. **รองรับ WebRTC**: เพิ่มการสตรีมวิดีโอด้วย WebRTC เพื่อลดความหน่วงและเพิ่มคุณภาพ
2. **ระบบ AI ขั้นสูง**: เพิ่มการตรวจจับใบหน้าและการแยกแยะลูกค้า/พนักงาน
3. **แดชบอร์ดแบบ Real-time**: พัฒนาแดชบอร์ดที่อัพเดตแบบเรียลไทม์ด้วย WebSockets
4. **Mobile App**: พัฒนาแอปพลิเคชันมือถือเพื่อรับการแจ้งเตือนและดูสถานะร้าน
5. **รองรับกล้องหลายยี่ห้อเพิ่มเติม**: เพิ่มการรองรับกล้องยี่ห้ออื่นๆ

## สรุป

การแปลงจาก GUI เป็นเว็บแอปพลิเคชันช่วยเพิ่มความสะดวกในการเข้าถึงและความยืดหยุ่นในการใช้งาน ทำให้ระบบสามารถเข้าถึงได้จากอุปกรณ์หลากหลายและสามารถจัดการได้จากระยะไกล ซึ่งเป็นประโยชน์อย่างมากสำหรับร้านค้าที่มีหลายสาขาหรือต้องการตรวจสอบข้อมูลจากนอกสถานที่